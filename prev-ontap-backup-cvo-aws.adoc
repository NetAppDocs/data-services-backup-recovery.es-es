---
sidebar: sidebar 
permalink: prev-ontap-backup-cvo-aws.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: Proteja sus cargas de trabajo de VMware con NetApp NetApp Backup and Recovery. 
---
= Realice una copia de seguridad de los datos de Cloud Volumes ONTAP en Amazon S3 con NetApp Backup and Recovery
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Complete algunos pasos en NetApp Backup and Recovery para comenzar a realizar copias de seguridad de los datos de volumen de sus sistemas Cloud Volumes ONTAP en Amazon S3.


NOTE: Para cambiar hacia y desde las cargas de trabajo de NetApp Backup and Recovery , consultelink:br-start-switch-ui.html["Cambiar a diferentes cargas de trabajo de NetApp Backup and Recovery"] .



== Verificar la compatibilidad con su configuración

Lea los siguientes requisitos para asegurarse de tener una configuración compatible antes de comenzar a realizar copias de seguridad de volúmenes en S3.

La siguiente imagen muestra cada componente y las conexiones que debes preparar entre ellos.

Opcionalmente, también puede conectarse a un sistema ONTAP secundario para volúmenes replicados utilizando la conexión pública o privada.

image:diagram_cloud_backup_cvo_aws.png["Un diagrama que muestra cómo NetApp Backup and Recovery se comunica con los volúmenes en los sistemas de origen y el almacenamiento de destino donde se encuentran los archivos de respaldo."]

El punto final de la puerta de enlace de VPC ya debe existir en su VPC. https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html["Obtenga más información sobre los puntos finales de la puerta de enlace"^] .

Versiones de ONTAP compatibles:: Mínimo de ONTAP 9.8; se recomienda ONTAP 9.8P13 y posterior.
Información necesaria para utilizar claves administradas por el cliente para el cifrado de datos:: Puede elegir sus propias claves administradas por el cliente para el cifrado de datos en el asistente de activación en lugar de utilizar las claves de cifrado predeterminadas de Amazon S3.  En este caso necesitarás tener las claves de cifrado administradas ya configuradas. https://docs.netapp.com/us-en/storage-management-cloud-volumes-ontap/task-setting-up-kms.html["Vea cómo utilizar sus propias llaves"^] .




== Verificar los requisitos de la licencia

Para las licencias PAYGO de NetApp Backup and Recovery , hay una suscripción de consola disponible en AWS Marketplace que permite implementaciones de Cloud Volumes ONTAP y NetApp Backup and Recovery.  Necesitas https://aws.amazon.com/marketplace/pp/prodview-oorxakq6lq7m4?sr=0-8&ref_=beagle&applicationId=AWSMPContessa["Suscríbete a esta suscripción de NetApp Console"^] antes de habilitar NetApp Backup and Recovery.  La facturación de NetApp Backup and Recovery se realiza a través de esta suscripción.

Para obtener un contrato anual que le permita realizar copias de seguridad de los datos de Cloud Volumes ONTAP y de los datos locales de ONTAP , debe suscribirse desde https://aws.amazon.com/marketplace/pp/prodview-q7dg6zwszplri["Página de AWS Marketplace"^] y luego https://docs.netapp.com/us-en/console-setup-admin/task-adding-aws-accounts.html["asociar la suscripción con sus credenciales de AWS"^] .

Para obtener un contrato anual que le permita combinar Cloud Volumes ONTAP y NetApp Backup and Recovery, debe configurar el contrato anual cuando cree un sistema Cloud Volumes ONTAP .  Esta opción no le permite realizar copias de seguridad de datos locales.

Para obtener una licencia BYOL de NetApp Backup and Recovery , necesita el número de serie de NetApp que le permite utilizar el servicio durante la duración y la capacidad de la licencia. link:br-start-licensing.html["Aprenda a administrar sus licencias BYOL"].  Debe utilizar una licencia BYOL cuando el agente de consola y el sistema Cloud Volumes ONTAP se implementan en un sitio oscuro.

Y necesitas tener una cuenta de AWS para el espacio de almacenamiento donde se ubicarán tus copias de seguridad.



== Prepare su agente de consola

El agente de consola debe instalarse en una región de AWS con acceso a Internet completo o limitado (modo "estándar" o "restringido"). https://docs.netapp.com/us-en/console-setup-admin/concept-modes.html["Consulte los modos de implementación de la NetApp Console para obtener más detalles"^] .

* https://docs.netapp.com/us-en/console-setup-admin/concept-connectors.html["Obtenga más información sobre los agentes de consola"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-aws.html["Implementar un agente de consola en AWS en modo estándar (acceso completo a Internet)"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-restricted-mode.html["Instalar el agente de consola en modo restringido (acceso saliente limitado)"^]




=== Verificar o agregar permisos al agente de la consola

El rol de IAM que proporciona permisos a la consola debe incluir permisos S3 de la última versión. https://docs.netapp.com/us-en/console-setup-admin/reference-permissions-aws.html["Política de consola"^] .  Si la política no contiene todos estos permisos, consulte la https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-edit.html["Documentación de AWS: Edición de políticas de IAM"^] .

A continuación se muestran los permisos específicos de la política:

[%collapsible]
====
[source, json]
----
{
  "Sid": "backupPolicy",
  "Effect": "Allow",
  "Action": [
    "s3:DeleteBucket",
    "s3:GetLifecycleConfiguration",
    "s3:PutLifecycleConfiguration",
    "s3:PutBucketTagging",
    "s3:ListBucketVersions",
    "s3:GetObject",
    "s3:DeleteObject",
    "s3:PutObject",
    "s3:ListBucket",
    "s3:ListAllMyBuckets",
    "s3:GetBucketTagging",
    "s3:GetBucketLocation",
    "s3:GetBucketPolicyStatus",
    "s3:GetBucketPublicAccessBlock",
    "s3:GetBucketAcl",
    "s3:GetBucketPolicy",
    "s3:PutBucketPolicy",
    "s3:PutBucketOwnershipControls",
    "s3:PutBucketPublicAccessBlock",
    "s3:PutEncryptionConfiguration",
    "s3:GetObjectVersionTagging",
    "s3:GetBucketObjectLockConfiguration",
    "s3:GetObjectVersionAcl",
    "s3:PutObjectTagging",
    "s3:DeleteObjectTagging",
    "s3:GetObjectRetention",
    "s3:DeleteObjectVersionTagging",
    "s3:PutBucketObjectLockConfiguration",
    "s3:DeleteObjectVersion",
    "s3:GetObjectTagging",
    "s3:PutBucketVersioning",
    "s3:PutObjectVersionTagging",
    "s3:GetBucketVersioning",
    "s3:BypassGovernanceRetention",
    "s3:PutObjectRetention",
    "s3:GetObjectVersion",
    "athena:StartQueryExecution",
    "athena:GetQueryResults",
    "athena:GetQueryExecution",
    "glue:GetDatabase",
    "glue:GetTable",
    "glue:CreateTable",
    "glue:CreateDatabase",
    "glue:GetPartitions",
    "glue:BatchCreatePartition",
    "glue:BatchDeletePartition"
  ],
  "Resource": [
    "arn:aws:s3:::netapp-backup-*"
  ]
}
----
====

NOTE: Al crear copias de seguridad en las regiones de AWS China, debe cambiar el nombre del recurso de AWS "arn" en todas las secciones _Resource_ en las políticas de IAM de "aws" a "aws-cn"; por ejemplo `arn:aws-cn:s3:::netapp-backup-*` .

Permisos necesarios de AWS Cloud Volumes ONTAP:: Cuando su sistema Cloud Volumes ONTAP ejecuta el software ONTAP 9.12.1 o posterior, la función IAM que proporciona permisos a ese sistema debe incluir un nuevo conjunto de permisos S3 específicamente para NetApp Backup and Recovery de la última versión. https://docs.netapp.com/us-en/storage-management-cloud-volumes-ontap/task-set-up-iam-roles.html["Política de Cloud Volumes ONTAP"^] .
+
--
Si creó el sistema Cloud Volumes ONTAP con la versión de consola 3.9.23 o superior, estos permisos ya deberían ser parte de la función de IAM.  De lo contrario, necesitará agregar los permisos faltantes.

--
Regiones de AWS compatibles:: NetApp Backup and Recovery es compatible con todas las regiones de AWS, incluidas las regiones de AWS GovCloud.
Configuración necesaria para crear copias de seguridad en una cuenta de AWS diferente:: De forma predeterminada, las copias de seguridad se crean utilizando la misma cuenta que la utilizada para su sistema Cloud Volumes ONTAP .  Si desea utilizar una cuenta de AWS diferente para sus copias de seguridad, debe:
+
--
* Verifique que los permisos "s3:PutBucketPolicy" y "s3:PutBucketOwnershipControls" sean parte del rol de IAM que proporciona permisos al agente de la consola.
* Agregue las credenciales de la cuenta de AWS de destino en la consola. https://docs.netapp.com/us-en/console-setup-admin/task-adding-aws-accounts.html#add-additional-credentials-to-a-connector["Vea cómo hacer esto"^] .
* Agregue los siguientes permisos en las credenciales de usuario en la segunda cuenta:
+
....
"athena:StartQueryExecution",
"athena:GetQueryResults",
"athena:GetQueryExecution",
"glue:GetDatabase",
"glue:GetTable",
"glue:CreateTable",
"glue:CreateDatabase",
"glue:GetPartitions",
"glue:BatchCreatePartition",
"glue:BatchDeletePartition"
....


--
Crea tus propios cubos:: De forma predeterminada, el servicio crea depósitos para usted.  Si desea utilizar sus propios depósitos, puede crearlos antes de iniciar el asistente de activación de copia de seguridad y luego seleccionar esos depósitos en el asistente.
+
--
link:prev-ontap-protect-journey.html["Obtenga más información sobre cómo crear sus propios buckets"^].

--




== Verificar los requisitos de red de ONTAP para replicar volúmenes

Si planea crear volúmenes replicados en un sistema ONTAP secundario mediante NetApp Backup and Recovery, asegúrese de que los sistemas de origen y destino cumplan con los siguientes requisitos de red.



==== Requisitos de red de ONTAP local

* Si el clúster está local, debe tener una conexión desde su red corporativa a su red virtual en el proveedor de la nube. Normalmente se trata de una conexión VPN.
* Los clústeres ONTAP deben cumplir requisitos adicionales de subred, puerto, firewall y clúster.
+
Dado que puede replicar en Cloud Volumes ONTAP o en sistemas locales, revise los requisitos de emparejamiento para los sistemas ONTAP locales. https://docs.netapp.com/us-en/ontap-sm-classic/peering/reference_prerequisites_for_cluster_peering.html["Consulte los requisitos previos para el peering de clústeres en la documentación de ONTAP"^] .





==== Requisitos de red de Cloud Volumes ONTAP

* El grupo de seguridad de la instancia debe incluir las reglas de entrada y salida requeridas: específicamente, reglas para ICMP y los puertos 11104 y 11105. Estas reglas están incluidas en el grupo de seguridad predefinido.


* Para replicar datos entre dos sistemas Cloud Volumes ONTAP en diferentes subredes, las subredes deben enrutarse juntas (esta es la configuración predeterminada).




== Habilitar NetApp Backup and Recovery en Cloud Volumes ONTAP

Habilitar NetApp Backup and Recovery es fácil.  Los pasos varían levemente dependiendo de si tiene un sistema Cloud Volumes ONTAP existente o uno nuevo.

*Habilitar NetApp Backup and Recovery en un nuevo sistema*

NetApp Backup and Recovery está habilitado de forma predeterminada en el asistente del sistema.  Asegúrese de mantener la opción habilitada.

Ver https://docs.netapp.com/us-en/storage-management-cloud-volumes-ontap/task-deploying-otc-aws.html["Lanzamiento de Cloud Volumes ONTAP en AWS"^] para conocer los requisitos y detalles para crear su sistema Cloud Volumes ONTAP .

.Pasos
. Desde la página *Sistemas* de la consola, seleccione *Agregar sistema*, elija el proveedor de nube y seleccione *Agregar nuevo*.  Seleccione *Crear Cloud Volumes ONTAP*.
. Seleccione *Amazon Web Services* como proveedor de nube y luego elija un solo nodo o un sistema HA.
. Complete la página de Detalles y Credenciales.
. En la página Servicios, deje el servicio habilitado y seleccione *Continuar*.
. Complete las páginas del asistente para implementar el sistema.


.Resultado
NetApp Backup and Recovery está habilitado en el sistema.  Después de haber creado volúmenes en estos sistemas Cloud Volumes ONTAP , inicie NetApp Backup and Recovery ylink:prev-ontap-backup-manage.html["Activar la copia de seguridad en cada volumen que desee proteger"] .

*Habilitar NetApp Backup and Recovery en un sistema existente*

Habilite NetApp Backup and Recovery en un sistema existente en cualquier momento directamente desde la consola.

.Pasos
. Desde la página *Sistemas* de la Consola, seleccione el clúster y seleccione *Habilitar* junto a Copia de seguridad y recuperación en el panel derecho.
+
Si el destino de Amazon S3 para sus copias de seguridad existe como un clúster en la página *Sistemas*, puede arrastrar el clúster al sistema Amazon S3 para iniciar el asistente de configuración.





== Activar copias de seguridad en sus volúmenes ONTAP

Active las copias de seguridad en cualquier momento directamente desde su sistema local.

Un asistente lo guiará a través de los siguientes pasos principales:

* <<Seleccione los volúmenes que desea respaldar>>
* <<Definir la estrategia de backup>>
* <<Revise sus selecciones>>


También puedes<<Mostrar los comandos API>> en el paso de revisión, para que pueda copiar el código para automatizar la activación de la copia de seguridad para sistemas futuros.



=== Iniciar el asistente

.Pasos
. Acceda al asistente para activar copias de seguridad y recuperación mediante una de las siguientes maneras:
+
** Desde la página *Sistemas* de la Consola, seleccione el sistema y seleccione *Habilitar > Volúmenes de respaldo* junto a Copia de seguridad y recuperación en el panel derecho.
+
Si el destino de AWS para sus copias de seguridad existe como un sistema en la página *Sistemas* de la consola, puede arrastrar el clúster de ONTAP al almacenamiento de objetos de AWS.

** Seleccione *Volúmenes* en la barra de Copia de seguridad y recuperación.  Desde la pestaña Volúmenes, seleccione *Acciones*image:icon-action.png["Icono de acciones"] opción de icono y seleccione *Activar copia de seguridad* para un solo volumen (que aún no tenga habilitada la replicación o la copia de seguridad en el almacenamiento de objetos).


+
La página de Introducción del asistente muestra las opciones de protección, incluidas instantáneas locales, replicación y copias de seguridad.  Si realizó la segunda opción en este paso, aparecerá la página Definir estrategia de respaldo con un volumen seleccionado.

. Continúe con las siguientes opciones:
+
** Si ya tienes un agente de consola, ya estás listo.  Simplemente seleccione *Siguiente*.
** Si aún no tiene un agente de consola, aparecerá la opción *Agregar un agente de consola*.  Referirse a<<Prepare su agente de consola>> .






=== Seleccione los volúmenes que desea respaldar

Seleccione los volúmenes que desea proteger.  Un volumen protegido es aquel que tiene una o más de las siguientes opciones: política de instantáneas, política de replicación, política de copia de seguridad a objeto.

Puede elegir proteger los volúmenes FlexVol o FlexGroup ; sin embargo, no puede seleccionar una combinación de estos volúmenes al activar la copia de seguridad de un sistema.  Vea cómolink:prev-ontap-backup-manage.html["Activar la copia de seguridad para volúmenes adicionales en el sistema"] (FlexVol o FlexGroup) después de haber configurado la copia de seguridad para los volúmenes iniciales.

[NOTE]
====
* Puede activar una copia de seguridad solo en un único volumen FlexGroup a la vez.
* Los volúmenes que seleccione deben tener la misma configuración SnapLock .  Todos los volúmenes deben tener SnapLock Enterprise habilitado o tener SnapLock deshabilitado.


====
.Pasos
Si los volúmenes que elige ya tienen políticas de instantáneas o replicación aplicadas, las políticas que seleccione más adelante sobrescribirán estas políticas existentes.

. En la página Seleccionar volúmenes, seleccione el volumen o los volúmenes que desea proteger.
+
** Opcionalmente, filtre las filas para mostrar solo volúmenes con determinados tipos de volumen, estilos y más para facilitar la selección.
** Después de seleccionar el primer volumen, puede seleccionar todos los volúmenes FlexVol (los volúmenes FlexGroup se pueden seleccionar uno a la vez solamente).  Para realizar una copia de seguridad de todos los volúmenes FlexVol existentes, marque primero un volumen y luego marque la casilla en la fila del título.
** Para realizar una copia de seguridad de volúmenes individuales, marque la casilla de cada volumen.


. Seleccione *Siguiente*.




=== Definir la estrategia de backup

Definir la estrategia de backup implica configurar las siguientes opciones:

* Ya sea que desee una o todas las opciones de respaldo: instantáneas locales, replicación y respaldo en almacenamiento de objetos
* Arquitectura
* Política de instantáneas locales
* Objetivo y política de replicación
+

NOTE: Si los volúmenes que elige tienen políticas de instantáneas y replicación diferentes a las políticas que selecciona en este paso, se sobrescribirán las políticas existentes.

* Realizar copias de seguridad de la información de almacenamiento de objetos (proveedor, cifrado, redes, política de copia de seguridad y opciones de exportación).


.Pasos
. En la página Definir estrategia de respaldo, elija una o todas las siguientes opciones.  Los tres están seleccionados por defecto:
+
** *Instantáneas locales*: si está realizando una replicación o una copia de seguridad en un almacenamiento de objetos, se deben crear instantáneas locales.
** *Replicación*: crea volúmenes replicados en otro sistema de almacenamiento ONTAP .
** *Copia de seguridad*: realiza copias de seguridad de los volúmenes en el almacenamiento de objetos.


. *Arquitectura*: Si eligió replicación y copia de seguridad, elija uno de los siguientes flujos de información:
+
** *En cascada*: la información fluye desde el sistema de almacenamiento primario al secundario, y desde el secundario al almacenamiento de objetos.
** *Distribución en abanico*: la información fluye desde el sistema de almacenamiento primario al secundario _y_ desde el primario al almacenamiento de objetos.
+
Para obtener detalles sobre estas arquitecturas, consultelink:prev-ontap-protect-journey.html["Planifique su viaje de protección"] .



. *Instantánea local*: elija una política de instantáneas existente o cree una nueva.
+

TIP: Para crear una política personalizada antes de activar la instantánea, consultelink:br-use-policies-create.html["Crear una política"] .

+
Para crear una política, seleccione *Crear nueva política* y haga lo siguiente:

+
** Introduzca el nombre de la póliza.
** Seleccione hasta cinco horarios, normalmente de diferentes frecuencias.
** Seleccione *Crear*.


. *Replicación*: Establezca las siguientes opciones:
+
** *Objetivo de replicación*: seleccione el sistema de destino y SVM.  Opcionalmente, seleccione el agregado o los agregados de destino y el prefijo o sufijo que se agregarán al nombre del volumen replicado.
** *Política de replicación*: elija una política de replicación existente o cree una.
+

TIP: Para crear una política personalizada, consultelink:br-use-policies-create.html["Crear una política"] .

+
Para crear una política, seleccione *Crear nueva política* y haga lo siguiente:

+
*** Introduzca el nombre de la póliza.
*** Seleccione hasta cinco horarios, normalmente de diferentes frecuencias.
*** Seleccione *Crear*.




. *Copia de seguridad del objeto*: si seleccionó *Copia de seguridad*, configure las siguientes opciones:
+
** *Proveedor*: Seleccione *Amazon Web Services*.
** *Configuración del proveedor*: ingrese los detalles del proveedor y la región donde se almacenarán las copias de seguridad.
+
Ingrese la cuenta de AWS utilizada para almacenar las copias de seguridad.  Esta puede ser una cuenta diferente a aquella donde reside el sistema Cloud Volumes ONTAP .

+
Si desea utilizar una cuenta de AWS diferente para sus copias de seguridad, debe agregar las credenciales de la cuenta de AWS de destino en la consola y agregar los permisos "s3:PutBucketPolicy" y "s3:PutBucketOwnershipControls" a la función de IAM que proporciona permisos a la consola.

+
Seleccione la región donde se almacenarán las copias de seguridad.  Esta puede ser una región diferente a donde reside el sistema Cloud Volumes ONTAP .

+
Cree un nuevo depósito o seleccione uno existente.

** *Clave de cifrado*: si creó un nuevo depósito, ingrese la información de la clave de cifrado que le proporcionó el proveedor.  Elija si utilizará las claves de cifrado de AWS predeterminadas o elegirá sus propias claves administradas por el cliente desde su cuenta de AWS para administrar el cifrado de sus datos. (https://docs.netapp.com/us-en/storage-management-cloud-volumes-ontap/task-setting-up-kms.html["Vea cómo utilizar sus propias claves de cifrado"^] ).
+
Si elige utilizar sus propias claves administradas por el cliente, ingrese al almacén de claves y a la información de la clave.



+

NOTE: Si eligió un depósito existente, la información de cifrado ya está disponible, por lo que no necesita ingresarla ahora.

+
** *Política de respaldo*: seleccione una política de almacenamiento de respaldo a objetos existente o cree una.
+

TIP: Para crear una política personalizada antes de activar la copia de seguridad, consultelink:br-use-policies-create.html["Crear una política"] .

+
Para crear una política, seleccione *Crear nueva política* y haga lo siguiente:

+
*** Introduzca el nombre de la póliza.
*** Seleccione hasta cinco horarios, normalmente de diferentes frecuencias.
*** Para las políticas de copia de seguridad a objeto, configure las configuraciones DataLock y Ransomware Resilience.  Para obtener más detalles sobre DataLock y Ransomware Resilience, consultelink:prev-ontap-policy-object-options.html["Configuración de la política de copia de seguridad en objeto"] .
*** Seleccione *Crear*.


** *Exportar instantáneas existentes al almacenamiento de objetos como copias de seguridad*: Si existen instantáneas locales para volúmenes en este sistema que coincidan con la etiqueta de programación de copias de seguridad que acaba de seleccionar para este sistema (por ejemplo, diaria, semanal, etc.), se mostrará este mensaje adicional. Marque esta casilla para que todas las instantáneas históricas se copien en el almacenamiento de objetos como archivos de respaldo para garantizar la protección más completa para sus volúmenes.


. Seleccione *Siguiente*.




=== Revise sus selecciones

Esta es la oportunidad de revisar sus selecciones y realizar ajustes, si es necesario.

.Pasos
. En la página Revisar, revise sus selecciones.
. Opcionalmente, marque la casilla para *Sincronizar automáticamente las etiquetas de la política de instantáneas con las etiquetas de la política de replicación y copia de seguridad*.  Esto crea instantáneas con una etiqueta que coincide con las etiquetas en las políticas de replicación y copia de seguridad.
. Seleccione *Activar copia de seguridad*.


.Resultado
NetApp Backup and Recovery comienza a realizar las copias de seguridad iniciales de sus volúmenes. La transferencia de línea base del volumen replicado y el archivo de respaldo incluye una copia completa de los datos del sistema de almacenamiento principal. Las transferencias posteriores contienen copias diferenciales de los datos del sistema de almacenamiento primario contenidos en las instantáneas.

Se crea un volumen replicado en el clúster de destino que se sincronizará con el volumen de almacenamiento principal.

Se crea un bucket S3 en la cuenta de servicio indicada por la clave de acceso S3 y la clave secreta ingresada, y los archivos de respaldo se almacenan allí.

Se muestra el panel de control de copias de seguridad de volumen para que pueda supervisar el estado de las copias de seguridad.

También puede supervisar el estado de los trabajos de copia de seguridad y restauración mediante ellink:br-use-monitor-tasks.html["Página de seguimiento de trabajos"] .



=== Mostrar los comandos API

Es posible que desee mostrar y, opcionalmente, copiar los comandos API utilizados en el asistente Activar copia de seguridad y recuperación.  Es posible que desee hacer esto para automatizar la activación de la copia de seguridad en sistemas futuros.

.Pasos
. Desde el asistente Activar copia de seguridad y recuperación, seleccione *Ver solicitud de API*.
. Para copiar los comandos al portapapeles, seleccione el icono *Copiar*.

